<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OncoScope - Cancer Genomics Analysis</title>
    <link rel="stylesheet" href="styles.css">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' http://localhost:8000 http://127.0.0.1:8000; connect-src 'self' http://localhost:8000 http://127.0.0.1:8000 ws://localhost:8000 ws://127.0.0.1:8000; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:;">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-section">
                <svg class="logo" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="24" cy="24" r="20" stroke="#2563eb" stroke-width="2"/>
                    <path d="M24 12C18.48 12 14 16.48 14 22C14 27.52 18.48 32 24 32C29.52 32 34 27.52 34 22C34 16.48 29.52 12 24 12ZM24 28C20.69 28 18 25.31 18 22C18 18.69 20.69 16 24 16C27.31 16 30 18.69 30 22C30 25.31 27.31 28 24 28Z" fill="#2563eb"/>
                    <circle cx="24" cy="22" r="4" fill="#2563eb"/>
                    <path d="M12 24L16 22L12 20" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
                    <path d="M36 24L32 22L36 20" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <div>
                    <h1>OncoScope</h1>
                    <p class="tagline">Privacy-First Cancer Genomics Analysis</p>
                    <p class="powered-by">Powered by Google Gemma 3n</p>
                </div>
            </div>
            
            <div class="status-section">
                <div id="connection-status" class="status-indicator" role="status" aria-live="polite">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- File Upload Section -->
            <section id="upload-section" class="card">
                <h2>Upload Mutation Data</h2>
                <div class="upload-area" id="upload-area">
                    <div class="upload-placeholder">
                        <svg class="upload-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L8 6H11V14H13V6H16L12 2Z" fill="#6b7280"/>
                            <path d="M20 18H4V11H2V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V11H20V18Z" fill="#6b7280"/>
                        </svg>
                        <p>Drop mutation file here or click to upload</p>
                        <p class="upload-hint">Supports: VCF, CSV, TXT formats</p>
                    </div>
                    <input type="file" id="file-input" accept=".vcf,.csv,.txt,.json" hidden>
                </div>
                
                <!-- Patient Information -->
                <div class="patient-info-section">
                    <h3>Patient Information (Optional)</h3>
                    <div class="patient-info-grid">
                        <div class="form-group">
                            <label for="patient-age">Age</label>
                            <input type="number" id="patient-age" min="0" max="120" placeholder="e.g., 65">
                        </div>
                        <div class="form-group">
                            <label for="patient-gender">Gender</label>
                            <select id="patient-gender">
                                <option value="">Select...</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cancer-type">Diagnosed Cancer Type (if known)</label>
                            <select id="cancer-type">
                                <option value="">Unknown/Not specified</option>
                                <option value="breast_adenocarcinoma">Breast - Adenocarcinoma</option>
                                <option value="breast_tnbc">Breast - Triple Negative (TNBC)</option>
                                <option value="lung_adenocarcinoma">Lung - Adenocarcinoma</option>
                                <option value="lung_squamous">Lung - Squamous Cell</option>
                                <option value="lung_sclc">Lung - Small Cell (SCLC)</option>
                                <option value="colorectal_adenocarcinoma">Colorectal - Adenocarcinoma</option>
                                <option value="prostate_adenocarcinoma">Prostate - Adenocarcinoma</option>
                                <option value="melanoma">Melanoma</option>
                                <option value="pancreatic_adenocarcinoma">Pancreatic - Adenocarcinoma</option>
                                <option value="ovarian_serous">Ovarian - Serous Carcinoma</option>
                                <option value="aml">Leukemia - AML</option>
                                <option value="cll">Leukemia - CLL</option>
                                <option value="dlbcl">Lymphoma - DLBCL</option>
                                <option value="glioblastoma">Brain - Glioblastoma</option>
                                <option value="other">Other...</option>
                            </select>
                            <input type="text" id="cancer-type-other" class="hidden" placeholder="Please specify cancer type">
                        </div>
                    </div>
                    <p class="info-note">Providing patient information enables more personalized risk assessment and treatment recommendations.</p>
                </div>
                
                <!-- Manual Input -->
                <div class="manual-input-section">
                    <h3>Or Enter Mutations Manually</h3>
                    <label for="mutation-input" class="sr-only">Enter genetic mutations</label>
                    <textarea id="mutation-input" 
                              placeholder="Enter mutations (one per line):&#10;TP53:c.524G>A&#10;EGFR:c.2573T>G&#10;KRAS:c.35G>A" 
                              rows="5"
                              aria-label="Enter genetic mutations, one per line"
                              aria-describedby="mutation-help"></textarea>
                    <div id="mutation-help" class="sr-only">Enter genetic mutations in the format GENE:variant, for example TP53:c.524G>A</div>
                    <button id="analyze-button" class="primary-button" disabled
                            aria-label="Analyze genetic mutations"
                            aria-describedby="analyze-help">
                        <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M9 2L7.17 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4H16.83L15 2H9ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17Z" fill="white"/>
                            <circle cx="12" cy="12" r="3" fill="white"/>
                        </svg>
                        Analyze Mutations
                    </button>
                </div>

                <!-- Quick Demo -->
                <div class="demo-section">
                    <p>Try a demo:</p>
                    <button class="demo-button" data-demo="high_risk" aria-label="Load demo data for high risk patient">High Risk Patient</button>
                    <button class="demo-button" data-demo="targetable" aria-label="Load demo data showing targetable mutations">Targetable Mutations</button>
                    <button class="demo-button" data-demo="low_risk" aria-label="Load demo data for low risk profile">Low Risk Profile</button>
                </div>
            </section>

            <!-- Analysis Progress -->
            <section id="progress-section" class="card hidden">
                <h2>Analysis in Progress</h2>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Initializing analysis...</p>
                </div>
                <div class="progress-steps">
                    <div class="step" id="step-1">
                        <div class="step-icon">1</div>
                        <span>Parsing Mutations</span>
                    </div>
                    <div class="step" id="step-2">
                        <div class="step-icon">2</div>
                        <span>Database Lookup</span>
                    </div>
                    <div class="step" id="step-3">
                        <div class="step-icon">3</div>
                        <span>AI Analysis</span>
                    </div>
                    <div class="step" id="step-4">
                        <div class="step-icon">4</div>
                        <span>Generating Report</span>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="card hidden">
                <div class="results-header">
                    <h2>Cancer Genomics Analysis Results</h2>
                    <button id="new-analysis-button" class="secondary-button" aria-label="Start a new mutation analysis">New Analysis</button>
                </div>
                
                <!-- Overall Risk Assessment -->
                <div class="risk-overview">
                    <div class="risk-score-container">
                        <div class="risk-score-circle">
                            <svg width="160" height="160">
                                <circle cx="80" cy="80" r="70" fill="none" stroke="#e5e7eb" stroke-width="10"/>
                                <circle id="risk-circle" cx="80" cy="80" r="70" fill="none" stroke="#2563eb" 
                                        stroke-width="10" stroke-dasharray="440" stroke-dashoffset="440"
                                        transform="rotate(-90 80 80)"/>
                            </svg>
                            <div class="risk-score-text">
                                <div class="risk-score" id="overall-risk-score">0.0</div>
                                <div class="risk-label" id="risk-classification">Analyzing...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="risk-details">
                        <div class="risk-metric">
                            <span class="metric-label">Confidence Score:</span>
                            <span class="metric-value" id="confidence-score">-</span>
                        </div>
                        <div class="risk-metric">
                            <span class="metric-label">Actionable Mutations:</span>
                            <span class="metric-value" id="actionable-count">-</span>
                        </div>
                        <div class="risk-metric">
                            <span class="metric-label">Pathogenic Variants:</span>
                            <span class="metric-value" id="pathogenic-count">-</span>
                        </div>
                        <div class="risk-metric">
                            <span class="metric-label">Known Mutations:</span>
                            <span class="metric-value" id="known-mutations">-</span>
                        </div>
                    </div>
                </div>

                <!-- Multi-Mutation Interaction Analysis -->
                <div id="multi-mutation-section" class="multi-mutation-analysis hidden">
                    <h3>Multi-Mutation Interaction Analysis</h3>
                    
                    <!-- Interaction Overview -->
                    <div class="interaction-overview">
                        <div class="interaction-summary">
                            <div class="summary-item">
                                <span class="summary-icon">🧬</span>
                                <div>
                                    <div class="summary-value" id="interaction-pattern">-</div>
                                    <div class="summary-label">Interaction Pattern</div>
                                </div>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">⚠️</span>
                                <div>
                                    <div class="summary-value" id="composite-risk">-</div>
                                    <div class="summary-label">Composite Risk</div>
                                </div>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">🎯</span>
                                <div>
                                    <div class="summary-value" id="precision-score">-</div>
                                    <div class="summary-label">Precision Medicine Score</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pathway Convergence -->
                    <div class="pathway-convergence">
                        <h4>Pathway Convergence Analysis</h4>
                        <div id="pathway-network" class="pathway-network">
                            <!-- Pathway visualization will go here -->
                        </div>
                        <div id="pathway-details" class="pathway-details">
                            <!-- Pathway details will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Therapeutic Strategy -->
                    <div class="therapeutic-strategy">
                        <h4>Optimized Therapeutic Strategy</h4>
                        <div id="combination-therapies" class="combination-therapies">
                            <!-- Combination therapies will be listed here -->
                        </div>
                    </div>
                    
                    <!-- Clinical Interpretation -->
                    <div class="clinical-interpretation">
                        <h4>Comprehensive Clinical Interpretation</h4>
                        <div id="interpretation-text" class="interpretation-text">
                            <!-- Interpretation will go here -->
                        </div>
                    </div>
                </div>

                <!-- Tumor Type Predictions -->
                <div class="tumor-predictions" id="tumor-predictions">
                    <h3>Predicted Cancer Types</h3>
                    <div class="tumor-list" id="tumor-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Individual Mutation Results -->
                <div class="mutations-section">
                    <h3>Individual Mutation Analysis</h3>
                    <div class="mutations-results" id="mutations-results">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Clinical Recommendations -->
                <div class="recommendations-section">
                    <h3>Clinical Recommendations</h3>
                    <div id="clinical-recommendations">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Warnings -->
                <div id="warnings-section" class="warnings-section hidden">
                    <h3>� Warnings</h3>
                    <div id="warnings-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Export Options -->
                <div class="export-section">
                    <button id="export-pdf" class="secondary-button" aria-label="Export analysis results as PDF report">
                        <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM6 20V4H13V9H18V20H6Z" fill="currentColor"/>
                            <path d="M8 15H16V17H8V15ZM8 11H16V13H8V11Z" fill="currentColor"/>
                        </svg>
                        Export PDF Report
                    </button>
                    <button id="export-json" class="secondary-button" aria-label="Export raw analysis data as JSON">
                        <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM6 20V4H13V9H18V20H6Z" fill="currentColor"/>
                            <path d="M9 13H11V16H13V13H15L12 10L9 13Z" fill="currentColor"/>
                        </svg>
                        Export Raw Data
                    </button>
                    <button id="save-results" class="secondary-button" aria-label="Save analysis results to local storage">
                        <svg class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M17 3H5C3.89 3 3 3.9 3 5V19C3 20.1 3.89 21 5 21H19C20.1 21 21 20.1 21 19V7L17 3ZM19 19H5V5H16.17L19 7.83V19ZM12 12C10.34 12 9 13.34 9 15C9 16.66 10.34 18 12 18C13.66 18 15 16.66 15 15C15 13.34 13.66 12 12 12ZM6 6H15V10H6V6Z" fill="currentColor"/>
                        </svg>
                        Save Results
                    </button>
                </div>
            </section>
        </main>

        <!-- Privacy Notice -->
        <footer class="privacy-notice">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1ZM12 11.99H19C18.47 16.11 15.72 19.78 12 20.93V12H5V6.3L12 3.19V11.99Z" fill="#059669"/>
            </svg>
            <p>All analysis performed locally. Your genetic data never leaves this device.</p>
        </footer>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Error</h3>
            <p id="error-message"></p>
            <button class="primary-button" onclick="closeErrorModal()">OK</button>
        </div>
    </div>

    <script src="renderer.js?v=2.0"></script>
</body>
</html>